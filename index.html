<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risiko Ranking</title>
    <link rel="stylesheet" href="style.css">
    <script src="app.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <h1>Risiko Ranking</h1>
            <p class="subtitle">Classifica Ufficiale</p>
        </header>

        <nav>
            <a href="index.html" class="active">Classifica</a>
            <a href="matches.html">Partite</a>
            <a href="rules.html">Regolamento</a>
            <a href="admin.html">Admin</a>
        </nav>

        <div class="card">
            <div id="loading" class="loading">Caricamento...</div>
            <div class="table-container fade-in">
                <table id="leaderboard" class="hidden">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Giocatore</th>
                            <th>Partite</th>
                            <th>Rating</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        <!-- Populated via JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const players = await fetchAPI('/leaderboard');
                const tbody = document.getElementById('leaderboard-body');
                const loading = document.getElementById('loading');
                const table = document.getElementById('leaderboard');

                loading.classList.add('hidden');
                table.classList.remove('hidden');

                let rankCounter = 0;
                let provisionalHeaderShown = false;

                players.forEach((p) => {
                    const tr = document.createElement('tr');

                    let rankDisplay;
                    if (p.is_ranked) {
                        rankCounter++;
                        rankDisplay = rankCounter;
                    } else {
                        tr.classList.add('provisional');
                        rankDisplay = '<span title="Punteggio Provvisorio (Troppe poche partite)">-</span>';
                    }

                    tr.innerHTML = `
                        <td class="rank-cell">${rankDisplay}</td>
                        <td style="font-weight: 500">
                            ${p.name} 
                            ${!p.is_ranked ? `<span style="font-size: 0.75rem; opacity: 0.7; margin-left: 5px;">(Provvisorio)</span>` : ''}
                        </td>
                        <td>
                            ${p.games_played} 
                            ${!p.is_ranked ? `<span style="font-size: 0.7rem; color: var(--text-secondary); display: block;">Minimo: ${p.threshold}</span>` : ''}
                        </td>
                        <td class="rating-cell">
                            ${formatRating(p.rating)}
                            <a href="player.html?id=${p.id}" style="float: right; color: var(--text-secondary); text-decoration: none; font-size: 0.8em">â†—</a>
                        </td>
                    `;
                    tr.onclick = () => window.location.href = `player.html?id=${p.id}`;
                    tr.style.cursor = 'pointer';
                    tbody.appendChild(tr);
                });
            } catch (err) {
                document.getElementById('loading').innerText = 'Errore caricamento: ' + err.message;
            }
        });
    </script>
</body>

</html>